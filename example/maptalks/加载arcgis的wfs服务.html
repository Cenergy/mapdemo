<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>地图 - 显示</title>
<style type="text/css">
    html,
    body {
        margin: 0px;
        height: 100%;
        width: 100%
    }

    .container {
        width: 100%;
        height: 100%
    }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/maptalks@0.40.5/dist/maptalks.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/maptalks@0.40.5/dist/maptalks.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>

<body>

    <div id="map" class="container"></div>

    <script>
        var map = new maptalks.Map('map', {
            center: [112, 31.5],
            zoom: 8,
            baseLayer: new maptalks.TileLayer('base', {
                urlTemplate: 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                subdomains: ['a', 'b', 'c'],
                attribution: '&copy; <a href="http://www.osm.org" target="_blank">OpenStreetMap</a> contributors'
            })
        });
        postDataFrom("http://120.77.215.143:6080/arcgis/rest/services/xiangyang/xiangyang/MapServer/0");
        function postDataFrom(url) {
            var _url = url;
            var filter = "/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=&returnGeometry=true&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&f=pjson";
            var requestUrl = _url + filter;
            $.ajax({
                url: requestUrl, async: true, dataType: 'jsonp',
                success: function (e) {
                    var data = maptalks.Util.parseJSON(e);
                    var filterUrl = _url + "?f=pjson"
                    $.ajax({
                        url: filterUrl,
                        async: false, dataType: 'jsonp',
                        success: function (res) {
                            var lInfo = maptalks.Util.parseJSON(res);
                            var layerData = { data: data, info: lInfo };
                            console.log(layerData);
                            var geometries = addData(layerData);
                        },
                        error: function (b) {

                        }
                    })
                },
                err: function (a) { }
            });
        };
        function addData(layerData) {
            var geodata = null;
            if (!(layerData instanceof Object))
                return;
            if (!layerData.info.geometryType) {
                throw new Error("The layer's geometry type is unknown");
                return;
            }
            switch (layerData.info.geometryType) {
                case "esriGeometryPoint":
                    geodata = processMarkers(layerData);
                    break;
                case "esriGeometryPolygon":
                    geodata = processPolygons(layerData);
                    break;
                case "esriGeometryPolyline":
                    geodata = processPolylines(layerData);
                    break;
                default:
                    break;
            }
            return geodata;
        }
        //点
        function processMarkers(layerData){ 

        }
        //线
        function processPolylines(layerData){
            
        }
        //面
        function processPolygons(layerData){
            console.log(layerData);
        }
    </script>
</body>

</html>